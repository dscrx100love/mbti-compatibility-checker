// ユーティリティ関数

// ローカルストレージのキー
const STORAGE_KEYS = {
    FAVORITES: 'mbti_favorites',
    RECENT_RESULTS: 'mbti_recent_results',
    EMAIL_SUBMITTED: 'mbti_email_submitted'
};

// お気に入りの管理
const favoritesManager = {
    // お気に入りを取得
    getFavorites() {
        const stored = localStorage.getItem(STORAGE_KEYS.FAVORITES);
        return stored ? JSON.parse(stored) : [];
    },

    // お気に入りに追加
    addFavorite(type1, type2) {
        const favorites = this.getFavorites();
        const key = `${type1}-${type2}`;
        
        if (!favorites.includes(key)) {
            favorites.push(key);
            localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));
            return true;
        }
        return false;
    },

    // お気に入りから削除
    removeFavorite(type1, type2) {
        const favorites = this.getFavorites();
        const key = `${type1}-${type2}`;
        const index = favorites.indexOf(key);
        
        if (index > -1) {
            favorites.splice(index, 1);
            localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));
            return true;
        }
        return false;
    },

    // お気に入りかどうかチェック
    isFavorite(type1, type2) {
        const favorites = this.getFavorites();
        const key = `${type1}-${type2}`;
        return favorites.includes(key);
    }
};

// 最近の結果の管理
const recentResultsManager = {
    // 最近の結果を取得
    getRecentResults() {
        const stored = localStorage.getItem(STORAGE_KEYS.RECENT_RESULTS);
        return stored ? JSON.parse(stored) : [];
    },

    // 結果を追加（最大5件）
    addResult(type1, type2) {
        const results = this.getRecentResults();
        const newResult = {
            type1,
            type2,
            timestamp: new Date().toISOString()
        };

        // 重複を削除
        const filtered = results.filter(r => !(r.type1 === type1 && r.type2 === type2));
        
        // 新しい結果を先頭に追加
        filtered.unshift(newResult);
        
        // 最大5件に制限
        const limited = filtered.slice(0, 5);
        
        localStorage.setItem(STORAGE_KEYS.RECENT_RESULTS, JSON.stringify(limited));
    }
};

// メール送信状態の管理
const emailManager = {
    // メール送信済みかチェック
    hasSubmittedEmail() {
        return localStorage.getItem(STORAGE_KEYS.EMAIL_SUBMITTED) === 'true';
    },

    // メール送信済みをマーク
    markEmailSubmitted() {
        localStorage.setItem(STORAGE_KEYS.EMAIL_SUBMITTED, 'true');
    }
};

// SNSシェア機能
const shareManager = {
    // 画像生成
    generateShareImage(type1, type2, score, title) {
        return new Promise((resolve) => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // キャンバスサイズ設定（Instagram対応）
            canvas.width = 1080;
            canvas.height = 1080;
            
            // 背景グラデーション
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#71C5BB');
            gradient.addColorStop(1, '#FFB6C1');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 装飾的な円
            ctx.globalAlpha = 0.1;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(200, 200, 150, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(880, 880, 120, 0, Math.PI * 2);
            ctx.fill();
            ctx.globalAlpha = 1;
            
            // 白い背景カード
            ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
            const cardX = 80;
            const cardY = 200;
            const cardWidth = canvas.width - 160;
            const cardHeight = 680;
            const radius = 30;
            
            ctx.beginPath();
            ctx.moveTo(cardX + radius, cardY);
            ctx.arcTo(cardX + cardWidth, cardY, cardX + cardWidth, cardY + radius, radius);
            ctx.arcTo(cardX + cardWidth, cardY + cardHeight, cardX + cardWidth - radius, cardY + cardHeight, radius);
            ctx.arcTo(cardX, cardY + cardHeight, cardX, cardY + cardHeight - radius, radius);
            ctx.arcTo(cardX, cardY, cardX + radius, cardY, radius);
            ctx.closePath();
            ctx.fill();
            
            // タイトル
            ctx.fillStyle = '#333';
            ctx.font = 'bold 48px "Noto Sans JP", sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('MBTI相性診断', canvas.width / 2, 320);
            
            // タイプ表示
            ctx.font = 'bold 72px "Noto Sans JP", sans-serif';
            ctx.fillStyle = '#5CA39A';
            const type1Data = mbtiTypes[type1];
            const type2Data = mbtiTypes[type2];
            ctx.fillText(`${type1Data.emoji} ${type1}`, canvas.width / 2, 450);
            
            ctx.fillText('×', canvas.width / 2, 530);
            
            ctx.fillText(`${type2Data.emoji} ${type2}`, canvas.width / 2, 610);
            
            // 星評価
            const starSize = 80;
            const starsY = 720;
            const totalStarsWidth = (starSize * 5) + (20 * 4); // 星5個 + 間隔4個
            let startX = (canvas.width - totalStarsWidth) / 2;
            
            ctx.font = `${starSize}px serif`;
            for (let i = 0; i < 5; i++) {
                if (i < score) {
                    ctx.fillStyle = '#FFD700';
                    ctx.fillText('★', startX, starsY);
                } else {
                    ctx.fillStyle = '#E0E0E0';
                    ctx.fillText('☆', startX, starsY);
                }
                startX += starSize + 20;
            }
            
            // 相性タイトル
            ctx.font = 'bold 42px "Noto Sans JP", sans-serif';
            ctx.fillStyle = '#333';
            ctx.fillText(title, canvas.width / 2, 800);
            
            // URL
            ctx.font = '28px "Noto Sans JP", sans-serif';
            ctx.fillStyle = '#666';
            ctx.fillText(window.location.href, canvas.width / 2, 850);
            
                    // 画像として返す
            canvas.toBlob(resolve, 'image/png');
        });
    },

    // 画像ダウンロード
    async downloadShareImage(type1, type2, score, title) {
        const blob = await this.generateShareImage(type1, type2, score, title);
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `MBTI相性診断_${type1}_${type2}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        this.showCopySuccess();
        document.querySelector('.copy-success-message').textContent = '画像をダウンロードしました！';
    },

    // Twitterシェア
    shareToTwitter(type1, type2, score) {
        const text = `私たちの相性は${score}つ星！ ${type1}×${type2}の組み合わせです💕\n\n`;
        const url = window.location.href;
        const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
        window.open(twitterUrl, '_blank', 'width=550,height=420');
    },

    // LINEシェア
    shareToLine(type1, type2, score) {
        const text = `MBTI相性診断の結果：${type1}×${type2}は${score}つ星の相性です！`;
        const url = window.location.href;
        const lineUrl = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
        window.open(lineUrl, '_blank');
    },

    // クリップボードにコピー
    copyToClipboard(type1, type2, score) {
        const text = `MBTI相性診断結果\n${type1} × ${type2}\n相性度: ${'★'.repeat(score)}${'☆'.repeat(5-score)}\n${window.location.href}`;
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => {
                this.showCopySuccess();
            });
        } else {
            // フォールバック
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            this.showCopySuccess();
        }
    },

    // コピー成功メッセージ
    showCopySuccess() {
        const message = document.createElement('div');
        message.className = 'copy-success-message';
        message.textContent = 'クリップボードにコピーしました！';
        message.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-small);
            box-shadow: var(--shadow);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        `;
        
        document.body.appendChild(message);
        
        setTimeout(() => {
            message.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => message.remove(), 300);
        }, 2000);
    }
};

// アニメーション用のユーティリティ
const animationUtils = {
    // 要素をフェードインで表示
    fadeIn(element, duration = 300) {
        element.style.opacity = '0';
        element.style.display = 'block';
        element.classList.remove('hidden');
        
        // リフローを強制
        element.offsetHeight;
        
        element.style.transition = `opacity ${duration}ms ease`;
        element.style.opacity = '1';
    },

    // 要素をフェードアウトで非表示
    fadeOut(element, duration = 300) {
        element.style.transition = `opacity ${duration}ms ease`;
        element.style.opacity = '0';
        
        setTimeout(() => {
            element.style.display = 'none';
            element.classList.add('hidden');
        }, duration);
    },

    // スクロールアニメーション
    scrollToElement(element, offset = 100) {
        const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;
        const offsetPosition = elementPosition - offset;

        window.scrollTo({
            top: offsetPosition,
            behavior: 'smooth'
        });
    }
};

// バリデーション
const validation = {
    // メールアドレスの検証
    isValidEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    },

    // MBTIタイプの検証
    isValidType(type) {
        return mbtiTypes.hasOwnProperty(type);
    }
};

// 統計情報の計算
const statistics = {
    // レア度の計算（仮の値）
    calculateRarity(type1, type2) {
        // 実際の統計データに基づいて計算（ここでは仮の実装）
        const typePopularity = {
            'INTJ': 2.1, 'INTP': 3.3, 'ENTJ': 1.8, 'ENTP': 3.2,
            'INFJ': 1.5, 'INFP': 4.4, 'ENFJ': 2.5, 'ENFP': 8.1,
            'ISTJ': 11.6, 'ISFJ': 13.8, 'ESTJ': 8.7, 'ESFJ': 12.3,
            'ISTP': 5.4, 'ISFP': 8.8, 'ESTP': 4.3, 'ESFP': 8.5
        };
        
        const probability = (typePopularity[type1] / 100) * (typePopularity[type2] / 100) * 100;
        return probability.toFixed(2);
    },

    // 相性分布の取得
    getCompatibilityDistribution() {
        const distribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        
        Object.values(compatibilityData).forEach(data => {
            distribution[data.score]++;
        });
        
        return distribution;
    }
};

// フォーマット関数
const formatters = {
    // 日付のフォーマット
    formatDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}/${month}/${day}`;
    },

    // スコアを星で表示（新しいHTML形式）
    formatStars(score) {
        let starsHTML = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= score) {
                starsHTML += `<span class="star filled">★</span>`;
            } else {
                starsHTML += `<span class="star empty">☆</span>`;
            }
        }
        return starsHTML;
    },
    
    // 旧形式（テキストのみ）
    formatStarsText(score) {
        return '★'.repeat(score) + '☆'.repeat(5 - score);
    },

    // アドバイスをタイプ別に分けてフォーマット
    formatAdvice(advice, type1, type2) {
        const type1Data = mbtiTypes[type1];
        const type2Data = mbtiTypes[type2];
        
        // 組み合わせ固有のアドバイスを優先的に使用
        return this.formatCombinationSpecificAdvice(type1, type2, type1Data, type2Data);
    },

    // 組み合わせ固有のアドバイスをフォーマット
    formatCombinationSpecificAdvice(type1, type2, type1Data, type2Data) {
        // 組み合わせ固有のアドバイスを生成
        const type1Advice = this.generateSpecificAdvice(type1, type2, 'first');
        const type2Advice = this.generateSpecificAdvice(type2, type1, 'second');
        
        let html = '';
        
        // Type1向けアドバイス
        html += `
            <div class="advice-section">
                <h4 class="advice-title">${type1Data.emoji} ${type1Data.name}(${type1})へのアドバイス</h4>
                <div class="advice-content">
                    ${type1Advice.map(advice => `<p>${advice}</p>`).join('')}
                </div>
            </div>
        `;
        
        // Type2向けアドバイス
        html += `
            <div class="advice-section">
                <h4 class="advice-title">${type2Data.emoji} ${type2Data.name}(${type2})へのアドバイス</h4>
                <div class="advice-content">
                    ${type2Advice.map(advice => `<p>${advice}</p>`).join('')}
                </div>
            </div>
        `;
        
        return html;
    },

    // 具体的で実践的なアドバイスを生成
    generateSpecificAdvice(targetType, partnerType, position) {
        // アドバイスの方向を修正：targetType向けのアドバイスは、partnerType-targetTypeの組み合わせから取得
        const combinationKey = `${partnerType}-${targetType}`;
        
        // 組み合わせ別の具体的アドバイス（ターゲット本人向けのアドバイス）
        const specificAdviceData = {
            // INTJ本人へのアドバイス（各相手タイプに対して）
            'INTJ-ENFP': [
                'パートナーの新しいアイデアには「面白そう！」と最初にポジティブな反応を示してもらえると嬉しいです。',
                '一緒に新しい場所へ出かける計画を月に一度は立ててもらえるといいでしょう。',
                'ディスカッションの時は、相手の意見を否定せず建設的な議論を心がけてもらいましょう。'
            ],
            'INTJ-INFP': [
                'パートナーの価値観について「君の考えを聞かせて」と穏やかに尋ね、じっくり聞く時間を作ってみてください。',
                '意見が合わない時は「なるほど、そういう見方もあるんだね」とまず受け入れる姿勢を見せると、関係がより深まります。',
                'パートナーが創作活動をしている時は、作業を中断させず、そっと見守る時間を作ってあげてください。'
            ],
            'INTJ-ENFJ': [
                '相手の人を思いやる気持ちを「君の優しさを尊敬している」と言葉で表現しましょう。',
                '大勢の人との集まりに誘われた時は、「少し疲れたら教えて」と前もって伝えましょう。',
                '相手の感情的な話に対して、「大変だったね」とまず共感の言葉をかけましょう。'
            ],
            'INTJ-INTJ': [
                '毎朝「今日も一緒に頑張ろう」と声をかけて、協力関係を築きましょう。',
                '意見が対立した時は、「どちらの方法がより効果的だろう？」と建設的に話し合いましょう。',
                '相手の成果を「さすがだね、よく考えられている」と具体的に認めましょう。'
            ],
            'INTJ-INTP': [
                '相手の理論的な話に「なるほど、興味深い視点だね」と関心を示しましょう。',
                '締切のある作業は、「一緒に計画を立ててみよう」と協力して進めましょう。',
                '相手のペースを尊重し、「君の考える時間を待つよ」と伝えましょう。'
            ],
            'INTJ-ENTJ': [
                '相手のリーダーシップを「頼りになる、ついていく」と素直に認めましょう。',
                '違う意見を持った時は、データや根拠を示して建設的に議論しましょう。',
                '相手の決断力を「迅速で的確な判断だね」と評価しましょう。'
            ],
            'INTJ-ENTP': [
                '相手の新しいアイデアに「可能性を感じる、面白い」と前向きに反応しましょう。',
                '議論の時は、「その視点は考えていなかった」と相手の発想を認めましょう。',
                '相手の自由な発想を「クリエイティブで刺激的だね」と評価しましょう。'
            ],
            'INTJ-ISFJ': [
                '「いつもありがとう」と言葉で伝え、相手の好きな花やスイーツを買って帰りましょう。',
                '相手の家族の誕生日を覚えておき「お母さん、誕生日おめでとうって伝えてね」と声をかけましょう。',
                '「今日もお疲れ様、無理しないでね」と相手の心身を気遣う一言をかけましょう。'
            ],
            'INTJ-ISFP': [
                '相手の感性を「美しい感覚を持っているね」と認めて褒めましょう。',
                '急かさず、「君のペースで大丈夫だよ」と時間的な余裕を与えましょう。',
                '相手の価値観を「君らしい考え方で素敵だね」と受け入れましょう。'
            ],
            'INTJ-ESFP': [
                '相手の明るさに「君といると楽しくなる」と感謝の気持ちを伝えましょう。',
                '社交的な場面では、「君が場を盛り上げてくれて助かる」と頼りにしていることを伝えましょう。',
                '相手の感情の変化に「今日は元気がないね、どうしたの？」と気遣いを見せましょう。'
            ],
            'INTJ-ESFJ': [
                '相手の心遣いを「いつも周りを見ていて素晴らしい」と具体的に褒めましょう。',
                '社交的な場面では、「君がいてくれて安心できる」と頼りにしていることを伝えましょう。',
                '相手の感情に「大変だったね、お疲れ様」と共感の言葉をかけましょう。'
            ],
            'INTJ-ISTJ': [
                '相手の責任感を「いつも確実にやってくれて安心」と信頼を表現しましょう。',
                '計画を立てる時は、「一緒に確認しながら進めよう」と協力を提案しましょう。',
                '相手の安定感を「一緒にいると安心できる」と伝えましょう。'
            ],
            'INTJ-ISTP': [
                '相手の一人の時間を「ゆっくりして」と尊重し、適度な距離を保ちましょう。',
                '相手の技術や能力を「器用だね、すごい技術だ」と具体的に褒めましょう。',
                '急かさず相手のペースを「君のペースで大丈夫」と受け入れましょう。'
            ],
            'INTJ-ESTJ': [
                '相手の決断力を「頼りになる、さすが」と認める言葉をかけましょう。',
                '計画を立てる時は相手の意見を聞き、「どう進めるのがいい？」と相談しましょう。',
                '相手の効率的なやり方を「勉強になる」と素直に学ぶ姿勢を見せましょう。'
            ],
            'INTJ-ESTP': [
                '相手のアクティブな提案に「楽しそう！やろう」と積極的に参加しましょう。',
                '相手の行動力を「いつもエネルギッシュで素敵」と認める言葉をかけましょう。',
                '一緒に新しい体験を「今度は〜をしてみよう」と提案し合いましょう。'
            ],
            'INTJ-INFJ': [
                '相手の洞察力を「いつも核心を突いていて素晴らしい」と認めましょう。',
                '長期的な視点について、「君の未来への考えは参考になる」と評価しましょう。',
                '相手が疲れている時は、「今日はゆっくり休んで」と気遣いを見せましょう。'
            ],

            // ENFP本人へのアドバイス（各相手タイプに対して）
            'ENFP-INTJ': [
                '大切な話をする時は、パートナーが集中できる静かな環境を選んで話してみてください。',
                'パートナーの長期計画について「その目標、素晴らしいね！」と興味を示して応援してあげてください。',
                '急にプランを変更したい時は、理由を説明してパートナーの同意を得てから行動するといいですよ。'
            ],
            'ENFP-INFP': [
                'パートナーの価値観を深く理解しようと努めて「君の考え方に共感するよ」と伝えてみてください。',
                'パートナーが一人の時間を必要としている時は「ゆっくり過ごしてね」と理解を示してあげてください。',
                'パートナーの感情に寄り添って「君の気持ち、よくわかるよ」と共感を表現してみてください。'
            ],
            'ENFP-ENFP': [
                'アイデアが重なった時は、「一緒に考えるともっと良くなりそう」と協力を提案しましょう。',
                '相手の熱意に「君のエネルギーに刺激される」と感謝を伝えましょう。',
                '疲れた時は、「今日は一緒にゆっくりしよう」と休息を提案しましょう。'
            ],
            'ENFP-ENFJ': [
                '相手の人への思いやりを「いつも周りを大切にしていて素晴らしい」と認めましょう。',
                '社交的な場面では、相手の気遣いに「君がいてくれて安心できる」と感謝しましょう。',
                '相手が疲れている時は、「いつもお疲れ様、ありがとう」と労いの言葉をかけましょう。'
            ],
            'ENFP-INTP': [
                '相手の理論的な話に「興味深い視点だね」と関心を示しましょう。',
                '締切のある作業は、「一緒に計画を立ててみよう」と協力を提案しましょう。',
                '相手のペースを尊重し、「君の考える時間を待つよ」と伝えましょう。'
            ],
            'ENFP-ENTJ': [
                '相手の効率性を尊重し、約束の時間は5分前には到着するよう心がけましょう。',
                '新しいアイデアを提案する時は、具体的なメリットも一緒に説明しましょう。',
                '相手が疲れている時は、「今日はお疲れ様」と労い、リラックスできる環境を作りましょう。'
            ],
            'ENFP-ENTP': [
                '相手のアイデアに「それは思いつかなかった、面白い」と素直に認めましょう。',
                '議論の時は、「君の視点で新しい発見がある」と学びの姿勢を見せましょう。',
                '一緒に活動する時は、「相乗効果でより良いものができそう」と協力を楽しみましょう。'
            ],
            'ENFP-ISFJ': [
                '相手の気遣いに気づいた時は、その場で「ありがとう、助かった」と感謝を伝えましょう。',
                '新しいアイデアを話す時は、相手のペースに合わせて少しずつ説明しましょう。',
                '相手が疲れていそうな時は、「今日は君の好きなことをしよう」と提案しましょう。'
            ],
            'ENFP-ISFP': [
                '相手の感性を「美しいセンスを持っているね」と認めましょう。',
                'プライベートな時間を「一人の時間も大切だね」と理解しましょう。',
                '相手の価値観を「君らしい考え方で素敵だ」と受け入れましょう。'
            ],
            'ENFP-ESFP': [
                '相手の人を楽しませる力を「君がいると場が明るくなる」と評価しましょう。',
                '感情の変化に「今日はどんな気分？」と敏感に気づいて声をかけましょう。',
                '一緒に人と交流する時は、「君と一緒だと自然に人とつながれる」と感謝しましょう。'
            ],
            'ENFP-ESFJ': [
                '相手の心遣いを「君の優しさに助けられている」と感謝を表現しましょう。',
                '無理をしていないか、「疲れていない？大丈夫？」と定期的に気遣いましょう。',
                '相手のサポートを「いつもありがとう、君がいてくれて心強い」と伝えましょう。'
            ],
            'ENFP-ISTJ': [
                '相手の計画性を「しっかりしていて安心できる」と信頼を表現しましょう。',
                '予定を変更したい時は、「事前に相談させて」と配慮を示しましょう。',
                '相手の責任感を「いつも信頼できて頼りになる」と評価しましょう。'
            ],
            'ENFP-ISTP': [
                '相手の技術力を「器用で何でもできて尊敬する」と評価しましょう。',
                '一人の時間を「大切な時間だね」と理解を示しましょう。',
                '相手のマイペースさを「君らしくて良いと思う」と受け入れましょう。'
            ],
            'ENFP-ESTJ': [
                '相手の計画性を「しっかりしていて頼りになる」と信頼を表現しましょう。',
                '自由に行動したい時は、「少し自由にさせて」と理解を求めましょう。',
                '相手の決断力を「いつも的確で安心できる」と評価しましょう。'
            ],
            'ENFP-ESTP': [
                '相手の行動力を「決断が早くて頼りになる」と信頼を表現しましょう。',
                '一緒に新しいことに挑戦する時は、「君となら何でもできそう」と期待を共有しましょう。',
                '相手の社交性を「人との関わりが自然で素敵だね」と認めましょう。'
            ],
            'ENFP-INFJ': [
                '相手の洞察力を「いつも深く考えていて尊敬する」と認めましょう。',
                '一人の時間を「大切な時間だね」と理解を示しましょう。',
                '相手の価値観を「意味のある考え方だね」と受け入れましょう。'
            ],

            // INFP本人へのアドバイス（各相手タイプに対して）
            'INFP-INTJ': [
                '相手の計画性を尊重し、重要な約束の前日には確認の連絡を入れましょう。',
                '自分の感情を伝える時は、「私は〜と感じている」と具体的に表現しましょう。',
                '相手が忙しい時期は、無理に時間を作ってもらおうとせず待つ姿勢を見せましょう。'
            ],
            'INFP-ENFP': [
                '相手のアイデアに「新しい視点で面白い」と興味を示しましょう。',
                '議論を楽しむ時は、「一緒に考えるのが楽しい」と伝えましょう。',
                '相手の自由な発想を「刺激的で勉強になる」と評価しましょう。'
            ],
            'INFP-INFP': [
                '相手の感性を「美しい感覚を持っているね」と認めましょう。',
                '価値観について話す時は、「君の考えに共感できる」と理解を示しましょう。',
                '相手の創作活動を「素晴らしい表現力だね」と応援しましょう。'
            ],
            'INFP-ENFJ': [
                '相手の価値観を「君らしい深い考えだね」と尊重しましょう。',
                '一人の時間を「大切な時間だね、ゆっくりして」と理解を示しましょう。',
                '相手の感情を「君の気持ちを大切にしたい」と受け入れましょう。'
            ],
            'INFP-INTP': [
                '相手の理論的な話に「興味深い視点だね」と関心を示しましょう。',
                '自分の価値観を話す時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手のペースを「君の考える時間を大切にして」と尊重しましょう。'
            ],
            'INFP-ENTJ': [
                '相手の決断力を「頼りになる、安心できる」と信頼を表現しましょう。',
                '目標について話す時は、「私も協力したい」と支援の意思を示しましょう。',
                '相手のエネルギーを「いつもパワフルで刺激を受ける」と評価しましょう。'
            ],
            'INFP-ENTP': [
                '相手の価値観を「深い考えを持っていて尊敬する」と認めましょう。',
                '意見が違う時は、「君の視点も大切だね」と受け入れる姿勢を見せましょう。',
                '相手の感情に「そう感じるのも自然だね」と共感を示しましょう。'
            ],
            'INFP-ISFJ': [
                '相手の気遣いを「いつも細かく気づいてくれてありがとう」と感謝しましょう。',
                '自分の価値観を話す時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手が疲れている時は、「今日は私がやるから休んで」と積極的にサポートしましょう。'
            ],
            'INFP-ISFP': [
                '相手の創作活動を「君の表現力は素晴らしい」と応援しましょう。',
                '感情を表現する時は、「君の気持ちがよく伝わってくる」と共感しましょう。',
                '相手の個性を「君らしさが好きだ」と受け入れましょう。'
            ],
            'INFP-ESFP': [
                '相手の明るさに「君といると楽しい気持ちになる」と感謝しましょう。',
                '一人の時間が欲しい時は、「少し静かに過ごしたい」と正直に伝えましょう。',
                '相手の社交性を「人との関わりが上手で素敵だね」と認めましょう。'
            ],
            'INFP-ESFJ': [
                '相手の心遣いを「いつも周りをよく見ていて素晴らしい」と感謝しましょう。',
                '自分の価値観を話す時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手の人への優しさを「君の優しさに心が温かくなる」と表現しましょう。'
            ],
            'INFP-ISTJ': [
                '相手の責任感を「いつも確実にやってくれて安心」と信頼を表現しましょう。',
                '約束や予定は確実に守り、「いつも信頼できる」と安心感を与えましょう。',
                '相手の安定感を「一緒にいると安心できる」と伝えましょう。'
            ],
            'INFP-ISTP': [
                '相手のスキルを「技術力が高くて尊敬する」と認めましょう。',
                '一人の時間を「お互いに大切な時間だね」と理解し合いましょう。',
                '相手の冷静さを「落ち着いていて安心できる」と伝えましょう。'
            ],
            'INFP-ESTJ': [
                '相手の決断力を「頼りになる、さすが」と認める言葉をかけましょう。',
                '意見を求められた時は、「私はこう思うけど、どうかな？」と控えめに伝えましょう。',
                '相手の効率的なやり方を「勉強になる」と素直に学ぶ姿勢を見せましょう。'
            ],
            'INFP-ESTP': [
                '相手の行動力を「いつもエネルギッシュで素敵」と認める言葉をかけましょう。',
                '一人の時間が欲しい時は、「少し集中したい時間がある」と正直に伝えましょう。',
                '相手の社交性を「人との関わりが自然で学ぶことが多い」と評価しましょう。'
            ],
            'INFP-INFJ': [
                '相手の洞察を「深い視点で参考になる」と評価しましょう。',
                '理想について語る時は、「一緒に実現していきたい」と共感しましょう。',
                '相手の感情に「よく理解できる、私も同じように感じる」と共感しましょう。'
            ],

            // ENFJ本人へのアドバイス（各相手タイプに対して）
            'ENFJ-INTJ': [
                '相手の一人の時間を「集中する時間も大切だね」と理解を示しましょう。',
                '長期的な計画を立てる時は、「どう思う？」と相手の意見を求めましょう。',
                '相手が疲れている時は、「今日は私が全部やるから」と積極的にサポートしましょう。'
            ],
            'ENFJ-ENFP': [
                '相手の価値観を「君らしい深い考えだね」と尊重しましょう。',
                '一人の時間を「大切な時間だね、ゆっくりして」と理解を示しましょう。',
                '相手の感情を「君の気持ちを大切にしたい」と受け入れましょう。'
            ],
            'ENFJ-INFP': [
                '相手の人への優しさを「いつも周りを大切にしていて素晴らしい」と認めましょう。',
                '自分の価値観を話す時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手が疲れている時は、「いつもお疲れ様、ありがとう」と労いの言葉をかけましょう。'
            ],
            'ENFJ-ENFJ': [
                '相手の人への思いやりを「君の優しさに学ぶことが多い」と認めましょう。',
                'お互いが疲れないよう、「今日は二人でゆっくり過ごそう」と休息を提案しましょう。',
                '周りの人のことで意見が分かれた時は、「一緒に最善策を考えよう」と協力しましょう。'
            ],
            'ENFJ-INTP': [
                '相手の一人の時間を「考える時間も大切だね」と尊重しましょう。',
                '相手の理論的な話に「面白い視点だね」と興味を示しましょう。',
                '急かさず、「君のペースで考えて」と時間的な余裕を与えましょう。'
            ],
            'ENFJ-ENTJ': [
                '相手のリーダーシップを「頼りになる、ついていきたい」と信頼を示しましょう。',
                '意見を伝える時は、「私はこう感じるけど、どう思う？」と相手の考えも聞きましょう。',
                '相手の努力を「いつも頑張っていて尊敬する」と認めましょう。'
            ],
            'ENFJ-ENTP': [
                '相手の新しいアイデアに「創造性豊かで素晴らしい」と評価しましょう。',
                '議論の時は、相手の発想を「そんな見方があるんだね」と受け入れましょう。',
                '相手の自由な発想を制限せず、「面白いことを考えるね」と応援しましょう。'
            ],
            'ENFJ-ISFJ': [
                '相手の気遣いを「いつも細かく気づいてくれてありがとう」と感謝しましょう。',
                'お互いが疲れすぎないよう、「たまには私がやるから休んで」と交代を提案しましょう。',
                '相手の努力を「いつも頑張っていて本当に素晴らしい」と認めましょう。'
            ],
            'ENFJ-ISFP': [
                '相手の感性を「美しいセンスを持っているね」と認めましょう。',
                'プライベートな時間を「一人の時間も大切だね」と理解しましょう。',
                '相手の価値観を「君らしい考え方で素敵だ」と受け入れましょう。'
            ],
            'ENFJ-ESFP': [
                '相手の明るさを「君がいると楽しい気持ちになる」と感謝しましょう。',
                '相手の人を楽しませる力を「場を明るくしてくれてありがとう」と評価しましょう。',
                '感情の変化に「今日はどんな気分？」と敏感に気づいて声をかけましょう。'
            ],
            'ENFJ-ESFJ': [
                '相手の心遣いを「君の優しさに助けられている」と感謝を表現しましょう。',
                'お互いが無理をしないよう、「疲れていない？大丈夫？」と気遣い合いましょう。',
                '周りへの配慮について、「一緒にサポートしていこう」と協力を提案しましょう。'
            ],
            'ENFJ-ISTJ': [
                '相手の責任感を「いつも確実にやってくれて安心」と信頼を表現しましょう。',
                '計画を立てる時は、「一緒に確認しながら進めよう」と協力を提案しましょう。',
                '相手の安定感を「一緒にいると安心できる」と伝えましょう。'
            ],
            'ENFJ-ISTP': [
                '相手の一人の時間を「集中する時間も必要だね」と理解を示しましょう。',
                '感情を表現する時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手の技術力を「器用で素晴らしいスキルだね」と認めましょう。'
            ],
            'ENFJ-ESTJ': [
                '相手の決断力を「頼りになる、さすが」と認める言葉をかけましょう。',
                '計画について話す時は、「どう進めるのがいい？」と相手の意見を聞きましょう。',
                '相手の効率性を「勉強になる、素晴らしい」と評価しましょう。'
            ],
            'ENFJ-ESTP': [
                '相手の行動力を「いつもエネルギッシュで素敵」と認める言葉をかけましょう。',
                'アクティブな提案に「楽しそう、一緒にやろう」と積極的に参加しましょう。',
                '相手の社交性を「人との関わりが自然で学ぶことが多い」と評価しましょう。'
            ],
            'ENFJ-INFJ': [
                '相手の洞察力を「いつも深く考えていて尊敬する」と認めましょう。',
                '一人の時間を「大切な時間だね」と理解を示しましょう。',
                '理想について語る時は、「一緒に実現していきたい」と共感しましょう。'
            ],

            // INTP本人へのアドバイス（各相手タイプに対して）
            'INTP-INTJ': [
                '相手の計画を「実現可能性が高くて素晴らしい」と評価しましょう。',
                'アイデアを提案する時は、「これについてどう思う？」と相手の意見を求めましょう。',
                '締切が近い時は、「手伝えることがあったら言って」とサポートを申し出ましょう。'
            ],
            'INTP-ENFP': [
                '相手の理論的な話に「興味深い視点だね」と関心を示しましょう。',
                '締切のある作業は、「一緒に計画を立ててみよう」と協力を提案しましょう。',
                '相手のペースを尊重し、「君の考える時間を待つよ」と伝えましょう。'
            ],
            'INTP-INFP': [
                '相手の理論的な話に「興味深い視点だね」と関心を示しましょう。',
                '自分の価値観を話す時は、「私はこう感じるんだ」と穏やかに伝えましょう。',
                '相手のペースを「君の考える時間を大切にして」と尊重しましょう。'
            ],
            'INTP-ENFJ': [
                '相手の一人の時間を「考える時間も大切だね」と尊重しましょう。',
                '相手の理論的な話に「面白い視点だね」と興味を示しましょう。',
                '急かさず、「君のペースで考えて」と時間的な余裕を与えましょう。'
            ],
            'INTP-INTP': [
                '相手の理論に「その考え方は興味深い」と関心を示しましょう。',
                '議論の時は、「君の視点で新しい発見がある」と学びの姿勢を見せましょう。',
                'お互いの考える時間を「一緒に深く考えよう」と大切にしましょう。'
            ],
            'INTP-ENTJ': [
                '相手のリーダーシップを「効率的で頼りになる」と認めましょう。',
                '理論的な提案をする時は、「実現可能性も考慮してみた」と具体性を示しましょう。',
                '相手の決断力を「迅速で的確だね」と評価しましょう。'
            ],
            'INTP-ENTP': [
                '相手のアイデアに「それは思いつかなかった、面白い」と素直に認めましょう。',
                '議論の時は、「君の視点で新しい発見がある」と学びの姿勢を見せましょう。',
                'お互いの理論を「一緒に発展させていこう」と協力しましょう。'
            ],
            'INTP-ISFJ': [
                '相手の気遣いを「いつも細かく気づいてくれてありがとう」と感謝しましょう。',
                '理論的な話をする時は、相手のペースに合わせて説明しましょう。',
                '相手が疲れている時は、「今日は私がやるから休んで」と積極的にサポートしましょう。'
            ],
            'INTP-ISFP': [
                '相手の感性を「美しいセンスを持っているね」と認めましょう。',
                '理論的な話をする時は、「君の視点も聞かせて」と相手の意見を求めましょう。',
                '相手の価値観を「君らしい考え方で素敵だ」と受け入れましょう。'
            ],
            'INTP-ESFP': [
                '相手の明るさを「君といると楽しい」と感謝の気持ちを伝えましょう。',
                '一人で考える時間が欲しい時は、「少し集中したい」と正直に説明しましょう。',
                '相手の社交性を「人との関わりが自然で素敵だね」と認めましょう。'
            ],
            'INTP-ESFJ': [
                '相手の気遣いを「いつも周りをよく見ていて素晴らしい」と感謝しましょう。',
                '一人の時間が欲しい時は、「少し考える時間が必要」と正直に伝えましょう。',
                '相手の人への優しさを「君の優しさに学ぶことが多い」と評価しましょう。'
            ],
            'INTP-ISTJ': [
                '相手の責任感を「いつも確実にやってくれて安心」と信頼を表現しましょう。',
                '理論的なアイデアを話す時は、「実現可能性も含めて考えてみた」と説明しましょう。',
                '相手の安定感を「一緒にいると安心できる」と伝えましょう。'
            ],
            'INTP-ISTP': [
                '相手の技術力を「いつも学ぶことがある」と感謝しましょう。',
                'お互いの一人の時間を「それぞれのペースを大切にしよう」と尊重しましょう。',
                '相手の冷静さを「落ち着いていて安心できる」と伝えましょう。'
            ],
            'INTP-ESTJ': [
                '相手の決断力を「頼りになる、さすが」と認める言葉をかけましょう。',
                '理論を実践する時は、「君の効率的なやり方を教えて」と学ぶ姿勢を見せましょう。',
                '相手の計画性を「よく組織されていて参考になる」と評価しましょう。'
            ],
            'INTP-ESTP': [
                '相手の行動力を「決断が早くて頼りになる」と信頼を表現しましょう。',
                '理論と実践を「君の経験と組み合わせると面白そう」と繋げましょう。',
                '相手の社交性を「人との関わりが自然で学ぶことが多い」と評価しましょう。'
            ],
            'INTP-INFJ': [
                '相手の洞察力を「いつも深く考えていて尊敬する」と認めましょう。',
                '一人の時間を「お互いに大切な時間だね」と理解を示しましょう。',
                '理論と直感を「君の洞察と組み合わせると新しい発見がある」と価値を認めましょう。'
            ],

            // ENTJ本人へのアドバイス（各相手タイプに対して）
            'ENTJ-INTJ': [
                '相手の深い分析力を「よく考えられている、参考になる」と尊重しましょう。',
                '計画を立てる時は、「君の視点も聞かせて」と意見を求めましょう。',
                '相手の慎重さを「丁寧で安心できる」と価値を認めましょう。'
            ],
            'ENTJ-ENFP': [
                '相手のアイデアに対して「それは実現可能だ」「一緒にやってみよう」と前向きな反応をしましょう。',
                '目標設定をする時は、相手の自由度を残しつつ大まかなフレームワークを提示しましょう。',
                '毎週末は仕事の話を控えて、相手の興味のある話題に時間を使いましょう。'
            ],
            'ENTJ-INFP': [
                '相手の価値観を「君の考え方は深くて学ぶことが多い」と尊重しましょう。',
                '急かさず、「君のペースで考えて」と時間的な余裕を与えましょう。',
                '相手の感情を「君の気持ちを理解したい」と受け入れる姿勢を見せましょう。'
            ],
            'ENTJ-ENFJ': [
                '相手の洞察力を「いつも核心を突いていて素晴らしい」と認めましょう。',
                '長期的な視点について、「君の未来への考えは参考になる」と評価しましょう。',
                '相手が疲れている時は、「今日はゆっくり休んで」と気遣いを見せましょう。'
            ],
            'ENTJ-INTP': [
                '相手のリーダーシップを「効率的で頼りになる」と認めましょう。',
                '理論的な提案をする時は、「実現可能性も考慮してみた」と具体性を示しましょう。',
                '相手の決断力を「迅速で的確だね」と評価しましょう。'
            ],
            'ENTJ-ENTJ': [
                '意見が違う時は、「どちらがより効果的だろう？」と建設的に話し合いましょう。',
                '相手の成果を「さすがだね、よくやった」と具体的に褒めましょう。',
                '協力する時は、「一緒に最高の結果を出そう」と共通の目標を確認しましょう。'
            ],
            'ENTJ-ENTP': [
                '相手の創造性を「いつも斬新なアイデアで刺激される」と評価しましょう。',
                '議論の時は、「その視点は面白い、検討してみよう」と前向きに応えましょう。',
                '相手の柔軟性を「変化に対応する力が素晴らしい」と認めましょう。'
            ],
            'ENTJ-ISFJ': [
                '相手の気遣いを「いつも細かく気づいてくれてありがとう」と感謝しましょう。',
                '計画を説明する時は、「どう思う？」と相手の意見を聞いてから進めましょう。',
                '相手が疲れている時は、「今日は私がやるから休んで」と積極的にサポートしましょう。'
            ],
            'ENTJ-ISFP': [
                '相手の感性を「美しいセンスを持っているね」と認めて褒めましょう。',
                '急かさず、「君のペースで大丈夫だよ」と時間的な余裕を与えましょう。',
                '相手の価値観を「君らしい考え方で素敵だね」と受け入れましょう。'
            ],
            'ENTJ-ESFP': [
                '相手の明るさを「君がいると楽しくなる」と感謝の気持ちを伝えましょう。',
                '社交的な場面では、「君が場を盛り上げてくれて助かる」と頼りにしていることを伝えましょう。',
                '相手の感情の変化に「今日は元気がないね、どうしたの？」と気遣いを見せましょう。'
            ],
            'ENTJ-ESFJ': [
                '相手の心遣いを「いつも周りを見ていて素晴らしい」と具体的に褒めましょう。',
                '社交的な場面では、「君がいてくれて安心できる」と頼りにしていることを伝えましょう。',
                '相手の感情に「大変だったね、お疲れ様」と共感の言葉をかけましょう。'
            ],
            'ENTJ-ISTJ': [
                '相手の責任感を「いつも確実にやってくれて安心」と信頼を表現しましょう。',
                '計画を立てる時は、「一緒に確認しながら進めよう」と協力を提案しましょう。',
                '相手の安定感を「一緒にいると安心できる」と伝えましょう。'
            ],
            'ENTJ-ISTP': [
                '相手の一人の時間を「ゆっくりして」と尊重し、適度な距離を保ちましょう。',
                '相手の技術や能力を「器用だね、すごい技術だ」と具体的に褒めましょう。',
                '急かさず相手のペースを「君のペースで大丈夫」と受け入れましょう。'
            ],
            'ENTJ-ESTJ': [
                '相手の決断力を「頼りになる、さすが」と認める言葉をかけましょう。',
                '計画を立てる時は相手の意見を聞き、「どう進めるのがいい？」と相談しましょう。',
                '相手の効率的なやり方を「勉強になる」と素直に学ぶ姿勢を見せましょう。'
            ],
            'ENTJ-ESTP': [
                '相手のアクティブな提案に「楽しそう！やろう」と積極的に参加しましょう。',
                '相手の行動力を「いつもエネルギッシュで素敵」と認める言葉をかけましょう。',
                '一緒に新しい体験を「今度は〜をしてみよう」と提案し合いましょう。'
            ],
            'ENTJ-INFJ': [
                '相手の洞察力を「いつも核心を突いていて素晴らしい」と認めましょう。',
                '長期的な視点について、「君の未来への考えは参考になる」と評価しましょう。',
                '相手が疲れている時は、「今日はゆっくり休んで」と気遣いを見せましょう。'
            ],

            // ENTP本人へのアドバイス（各相手タイプに対して）
            'ENTP-INTJ': [
                '相手の計画性を「しっかりしていて頼りになる」と信頼を表現しましょう。',
                '新しいアイデアを提案する時は、「実現方法も考えてみた」と具体性を示しましょう。',
                '相手の慎重さを「リスクを考えてくれて助かる」と感謝しましょう。'
            ],
            'ENTP-ENFP': [
                '相手のアイデアに「それは思いつかなかった、面白い」と素直に認めましょう。',
                '議論の時は、「君の視点で新しい発見がある」と学びの姿勢を見せましょう。',
                '一緒に活動する時は、「相乗効果でより良いものができそう」と協力を楽しみましょう。'
            ],
            'ENTP-INFP': [
                '相手の価値観を「深い考えを持っていて尊敬する」と認めましょう。',
                '意見が違う時は、「君の視点も大切だね」と受け入れる姿勢を見せましょう。',
                '相手の感情に「そう感じるのも自然だね」と共感を示しましょう。'
            ],
            'ENTP-ENFJ': [
                '相手の新しいアイデアに「創造性豊かで素晴らしい」と評価しましょう。',
                '議論の時は、相手の発想を「そんな見方があるんだね」と受け入れましょう。',
                '相手の自由な発想を制限せず、「面白いことを考えるね」と応援しましょう。'
            ],
            'ENTP-INTP': [
                '相手のアイデアに「それは思いつかなかった、面白い」と素直に認めましょう。',
                '議論の時は、「君の視点で新しい発見がある」と学びの姿勢を見せましょう。',
                'お互いの理論を「一緒に発展させていこう」と協力しましょう。'
            ],
            'ENTP-ENTJ': [
                '相手の創造性を「いつも斬新なアイデアで刺激される」と評価しましょう。',
                '議論の時は、「その視点は面白い、検討してみよう」と前向きに応えましょう。',
                '相手の柔軟性を「変化に対応する力が素晴らしい」と認めましょう。'
            ],
            'ENTP-ENTP': [
                'アイデアが競合した時は、「どちらも面白い、組み合わせてみよう」と提案しましょう。',
                '相手の発想を「そう来るとは思わなかった、すごい」と驚きと称賛を表しましょう。',
                '一緒に新しいことを始める時は、「一緒なら何でもできそう」と期待を共有しましょう。'
            ],
            'ENTP-ISFJ': [
                '相手の気遣いに気づいた時は、その場で「ありがとう、助かった」と感謝を伝えましょう。',
                '新しいアイデアを話す時は、相手のペースに合わせて少しずつ説明しましょう。',
                '相手が疲れていそうな時は、「今日は君の好きなことをしよう」と提案しましょう。'
            ],
            'ENTP-ISFP': [
                '相手の感性を「美しいセンスを持っているね」と認めましょう。',
                'プライベートな時間を「一人の時間も大切だね」と理解しましょう。',
                '相手の価値観を「君らしい考え方で素敵だ」と受け入れましょう。'
            ],
            'ENTP-ESFP': [
                '相手の人を楽しませる力を「君がいると場が明るくなる」と評価しましょう。',
                '感情の変化に「今日はどんな気分？」と敏感に気づいて声をかけましょう。',
                '一緒に人と交流する時は、「君と一緒だと自然に人とつながれる」と感謝しましょう。'
            ],
            'ENTP-ESFJ': [
                '相手の心遣いを「君の優しさに助けられている」と感謝を表現しましょう。',
                '無理をしていないか、「疲れていない？大丈夫？」と定期的に気遣いましょう。',
                '相手のサポートを「いつもありがとう、君がいてくれて心強い」と伝えましょう。'
            ],
            'ENTP-ISTJ': [
                '相手の計画性を「しっかりしていて安心できる」と信頼を表現しましょう。',
                '予定を変更したい時は、「事前に相談させて」と配慮を示しましょう。',
                '相手の責任感を「いつも信頼できて頼りになる」と評価しましょう。'
            ],
            'ENTP-ISTP': [
                '相手の技術力を「器用で何でもできて尊敬する」と評価しましょう。',
                '一人の時間を「大切な時間だね」と理解を示しましょう。',
                '相手のマイペースさを「君らしくて良いと思う」と受け入れましょう。'
            ],
            'ENTP-ESTJ': [
                '相手の計画性を「しっかりしていて頼りになる」と信頼を表現しましょう。',
                '自由に行動したい時は、「少し自由にさせて」と理解を求めましょう。',
                '相手の決断力を「いつも的確で安心できる」と評価しましょう。'
            ],
            'ENTP-ESTP': [
                '相手の行動力を「決断が早くて頼りになる」と信頼を表現しましょう。',
                '一緒に新しいことに挑戦する時は、「君となら何でもできそう」と期待を共有しましょう。',
                '相手の社交性を「人との関わりが自然で素敵だね」と認めましょう。'
            ],
            'ENTP-INFJ': [
                '相手の洞察力を「いつも深く考えていて尊敬する」と認めましょう。',
                '一人の時間を「大切な時間だね」と理解を示しましょう。',
                '相手の価値観を「意味のある考え方だね」と受け入れましょう。'
            ],
            
            // 追加の組み合わせ（よりカジュアルで親しみやすい表現）
            'INTP-ENFJ': [
                'パートナーの人への配慮を「いつも周りを気にかけてくれて素敵だね」と認めてあげてください。',
                '理論的な話をする時は「まあ、あくまで仮説だけど」と謙虚に前置きしてみると伝わりやすくなります。',
                'パートナーが疲れている時は「今日は君の好きなことをしようか」と提案してあげるといいでしょう。'
            ],
            'ISFJ-ENTP': [
                'パートナーの新しいアイデアに「それ面白そう！」と最初に反応してから、現実的な心配があれば優しく相談してみてください。',
                '計画的に物事を進めたい時は「ちょっと心配性かもしれないけど」と前置きして説明すると理解してもらえます。',
                'パートナーの自由な発想を「そんな考え方もあるんだね」と楽しんでみるといいですよ。'
            ],
            'ESTP-INFJ': [
                'パートナーが一人で考え込んでいる時は「何か手伝えることある？」と声をかけつつ、無理に話しかけないでいてあげてください。',
                '新しい体験に誘う時は「興味があったら一緒にやってみない？」と無理強いしない形で提案してみてください。',
                'パートナーの深い洞察を「そんな風に考えるんだね、すごいな」と素直に感心してあげるといいでしょう。'
            ],
            'ISFP-ENTJ': [
                'パートナーの目標について「応援してるよ」と支持を示しつつ、自分のペースも大切にしてくださいね。',
                '意見を求められた時は「私はこう感じるんだけど、どうかな？」と控えめに伝えてみてください。',
                'パートナーの決断力を「頼りになるね」と認めながら、時には「ちょっと休憩しない？」と提案してあげてください。'
            ],
            'ESFJ-INTP': [
                'パートナーの研究時間を「集中してるね、頑張って」と静かに見守ってあげてください。',
                '予定を伝える時は「都合の良い時でいいから」と柔軟性を持たせて話してみるといいですよ。',
                'パートナーの知識を「いろんなこと知ってて勉強になる」と尊敬を示してみてください。'
            ]
        };

        // 具体的アドバイスがある場合はそれを使用
        if (specificAdviceData[combinationKey]) {
            return specificAdviceData[combinationKey];
        }

        // ない場合は一般的だが具体的なアドバイスを生成
        return this.generateGenericSpecificAdvice(targetType, partnerType);
    },

    // 一般的だが具体的なアドバイスを生成
    generateGenericSpecificAdvice(targetType, partnerType) {
        const targetData = mbtiTypes[targetType];
        const partnerData = mbtiTypes[partnerType];
        
        const adviceTemplates = {
            'INTJ': [
                '毎朝「おはよう」と一緒にパートナーの名前を呼んで、一日の始まりを大切にしてみてください。',
                'パートナーの話を聞く時は、スマホを置いて目を見て集中して聞いてあげると喜ばれますよ。',
                '週に一度は「君のおかげで〜ができたよ」と感謝の気持ちを具体的に伝えてみてください。'
            ],
            'INTP': [
                'パートナーの興味のある話題について、一緒に調べたり学んだりする時間を作ってみるといいですね。',
                '約束の時間は守って、もし遅れそうな時は事前に連絡を入れてあげてください。',
                'パートナーが話している時は「なるほど」「それは興味深いね」と相槌を打って関心を示してみてください。'
            ],
            'ENTJ': [
                '毎日「今日もお疲れ様」とパートナーの努力を認める言葉をかけてあげてください。',
                '二人の将来について月に一度は話し合う時間を設けてみるといいでしょう。',
                'パートナーの意見を聞く時は、批判せずまず「そういう考え方もあるんだね」と受け入れてみてください。'
            ],
            'ENTP': [
                '相手の新しいアイデアには「面白そう！」と最初にポジティブな反応を示しましょう。',
                '一緒に新しい場所へ出かける計画を月に一度は立てましょう。',
                'ディスカッションの時は、相手の意見を否定せず建設的な議論を心がけましょう。'
            ],
            'INFJ': [
                '相手の気持ちに寄り添い、「大変だったね」「よく頑張ったね」と共感を示しましょう。',
                '直感で感じたことは、「なんとなくだけど」と前置きして正直に伝えましょう。',
                '二人だけの静かな時間を週に一度は必ず作りましょう。'
            ],
            'INFP': [
                '相手の価値観を尊重し、「君らしい考え方だね」と個性を認める言葉をかけましょう。',
                '感情的になった時は、時間を置いてから「さっきは感情的になってごめん」と謝りましょう。',
                '相手の創作活動や趣味を「素敵だね」「応援している」と積極的に支持しましょう。'
            ],
            'ENFJ': [
                '相手が周りを気遣っている時は、「いつもありがとう」と感謝の気持ちを伝えましょう。',
                '二人の関係について定期的に「今どう感じているか」を確認し合いましょう。',
                '相手が疲れている時は、「今日は私が全部やるから」と積極的にサポートしましょう。'
            ],
            'ENFP': [
                '相手の熱意に「すごいエネルギーだね」「感動した」と素直に反応しましょう。',
                '一緒に楽しいイベントや活動に参加する機会を積極的に作りましょう。',
                '相手が落ち込んでいる時は、「一緒にいるよ」と寄り添う姿勢を見せましょう。'
            ],
            'ISTJ': [
                '約束や予定は確実に守り、「いつも信頼できる」と安心感を与えましょう。',
                '感謝の気持ちを「いつもありがとう」と毎日欠かさず伝えましょう。',
                '変更がある時は事前に相談し、「どう思う？」と意見を求めましょう。'
            ],
            'ISFJ': [
                '相手の細やかな気遣いに「気づいてくれてありがとう」と感謝を表現しましょう。',
                '相手が無理をしていないか「疲れていない？」と定期的に体調を気遣いましょう。',
                '家事や用事は分担し、「一人で抱え込まないで」と支え合う姿勢を見せましょう。'
            ],
            'ESTJ': [
                '相手の決断力を「頼りになる」「さすが」と認める言葉をかけましょう。',
                '計画を立てる時は相手の意見を聞き、「どう進めるのがいい？」と相談しましょう。',
                '相手の効率的なやり方を「勉強になる」と素直に学ぶ姿勢を見せましょう。'
            ],
            'ESFJ': [
                '相手の心遣いに「君がいてくれて本当に良かった」と感謝の気持ちを伝えましょう。',
                '相手の大切な人間関係を理解し、「大事な人だね」と尊重する言葉をかけましょう。',
                '相手の感情の変化に「何か心配事がある？」と気づいて声をかけましょう。'
            ],
            'ISTP': [
                '相手の一人の時間を「ゆっくりして」と尊重し、適度な距離を保ちましょう。',
                '相手の技術や能力を「器用だね」「すごい技術だ」と具体的に褒めましょう。',
                '急かさず相手のペースを「君のペースで大丈夫」と受け入れましょう。'
            ],
            'ISFP': [
                '相手の感性を「素敵なセンスだね」「美しい感覚を持っているね」と認めましょう。',
                'プライベートな時間を「一人の時間も大切にして」と尊重しましょう。',
                '相手の価値観を「君らしい考えだね」と押し付けずに受け入れましょう。'
            ],
            'ESTP': [
                '相手のアクティブな提案に「楽しそう！やろう」と積極的に参加しましょう。',
                '相手の行動力を「いつもエネルギッシュで素敵」と認める言葉をかけましょう。',
                '一緒に新しい体験を「今度は〜をしてみよう」と提案し合いましょう。'
            ],
            'ESFP': [
                '相手の明るさに「君といると楽しい」「元気をもらえる」と感謝を伝えましょう。',
                '相手の感情の変化を「今日はどんな気分？」と敏感に察知して声をかけましょう。',
                '一緒に人と交流する機会を「みんなで会おう」と積極的に作りましょう。'
            ]
        };

        return adviceTemplates[targetType] || [
            '毎日「ありがとう」と感謝の気持ちを具体的に伝えましょう。',
            '相手の話をしっかり聞き、「そうなんだね」と共感を示しましょう。',
            '二人の時間を大切にし、週に一度は特別な時間を作りましょう。'
        ];
    },

    // 汎用的なアドバイスをフォーマット（既存システム）
    formatGenericAdvice(type1, type2, type1Data, type2Data) {
        // MBTIタイプ別の具体的アドバイステンプレート
        const adviceTemplates = {
            'INTJ': [
                '相手の長期的な目標や計画について真剣に話し合いましょう。',
                '相手の独立性と一人の時間を尊重してあげましょう。',
                '論理的な説明で相手を説得するよりも、感情面での理解を示しましょう。'
            ],
            'INTP': [
                '相手の興味のある分野について一緒に深く学んでみましょう。',
                '相手のペースに合わせて、急かさずに待ってあげましょう。',
                '抽象的な話題や理論的な議論を楽しんでみましょう。'
            ],
            'ENTJ': [
                '相手の目標達成をサポートし、励ましの言葉をかけましょう。',
                '効率的でない行動について、建設的にアドバイスしてあげましょう。',
                '相手のリーダーシップを認めて、尊敬の気持ちを伝えましょう。'
            ],
            'ENTP': [
                '相手の新しいアイデアに興味を示し、一緒に議論しましょう。',
                '変化や冒険を恐れず、相手と新しいことにチャレンジしましょう。',
                '相手の自由な発想を制限せず、創造性を応援しましょう。'
            ],
            'INFJ': [
                '相手の価値観や理想について深く理解しようと努めましょう。',
                '相手が疲れている時は、静かな環境で休息できるよう配慮しましょう。',
                '相手の直感や「なんとなく」の感覚も大切にしてあげましょう。'
            ],
            'INFP': [
                '相手の個性や独自性を認めて、ありのままを受け入れましょう。',
                '相手の感情に寄り添い、共感の気持ちを言葉で伝えましょう。',
                '相手のクリエイティブな活動や趣味を応援してあげましょう。'
            ],
            'ENFJ': [
                '相手の人助けや社会貢献活動を理解し、サポートしましょう。',
                '相手が他人のために疲れた時は、労いの言葉をかけてあげましょう。',
                '相手の共感力の高さを認めて、感謝の気持ちを表現しましょう。'
            ],
            'ENFP': [
                '相手の熱意や情熱的な話に真剣に耳を傾けましょう。',
                '相手の人とのつながりを大切にし、一緒に交流を楽しみましょう。',
                '相手のポジティブなエネルギーを受け取り、同じ温度感で応えましょう。'
            ],
            'ISTJ': [
                '相手の几帳面さや責任感の強さを認めて、感謝を伝えましょう。',
                '約束や予定は必ず守り、相手に安心感を与えましょう。',
                '急な変更は避け、事前に相談して相手の理解を得ましょう。'
            ],
            'ISFJ': [
                '相手の思いやりある行動に気づき、お礼の言葉を忘れずに。',
                '相手が無理をしていないか気遣い、休息を促してあげましょう。',
                '相手の支えてくれる行為に甘えすぎず、感謝の気持ちを行動で示しましょう。'
            ],
            'ESTJ': [
                '相手の計画性や組織力を評価し、頼りにしている気持ちを伝えましょう。',
                '相手の決断に従い、チームワークを意識して行動しましょう。',
                '相手の実用的なアドバイスに耳を傾け、実践してみましょう。'
            ],
            'ESFJ': [
                '相手の気遣いや周囲への配慮に感謝の気持ちを表しましょう。',
                '相手が大切にしている人間関係を理解し、一緒に維持しましょう。',
                '相手の感情的なニーズに敏感になり、寄り添ってあげましょう。'
            ],
            'ISTP': [
                '相手の一人の時間や自由な空間を尊重してあげましょう。',
                '相手の実用的なスキルや手先の器用さを認めて褒めましょう。',
                '相手のマイペースな性格を理解し、急かさないよう心がけましょう。'
            ],
            'ISFP': [
                '相手の繊細な感性や美的センスを理解し、共感を示しましょう。',
                '相手のプライベートな時間を大切にし、干渉しすぎないようにしましょう。',
                '相手の価値観を尊重し、押し付けがましい態度は避けましょう。'
            ],
            'ESTP': [
                '相手のアクティブな提案に積極的に参加し、一緒に楽しみましょう。',
                '相手の行動力や瞬発力を認めて、頼もしさを伝えましょう。',
                '相手の「今を楽しむ」姿勢から学び、一緒に新しい体験をしましょう。'
            ],
            'ESFP': [
                '相手の明るさや人を楽しませる能力に感謝を表しましょう。',
                '相手の感情の変化に敏感になり、タイミングよくサポートしましょう。',
                '相手の社交的な場面に一緒に参加し、人とのつながりを大切にしましょう。'
            ]
        };
        
        const type1Advice = adviceTemplates[type1] || [];
        const type2Advice = adviceTemplates[type2] || [];
        
        let html = '';
        
        // Type1向けアドバイス
        if (type1Advice.length > 0) {
            html += `
                <div class="advice-section">
                    <h4 class="advice-title">${type1Data.emoji} ${type1Data.name}へのアドバイス</h4>
                    <div class="advice-content">
                        ${type1Advice.map(advice => `<p>${advice}</p>`).join('')}
                    </div>
                </div>
            `;
        }
        
        // Type2向けアドバイス
        if (type2Advice.length > 0) {
            html += `
                <div class="advice-section">
                    <h4 class="advice-title">${type2Data.emoji} ${type2Data.name}へのアドバイス</h4>
                    <div class="advice-content">
                        ${type2Advice.map(advice => `<p>${advice}</p>`).join('')}
                    </div>
                </div>
            `;
        }
        
        // 共通アドバイス
        html += `
            <div class="advice-section">
                <h4 class="advice-title">💕 二人で心がけること</h4>
                <div class="advice-content">
                    <p>お互いの違いを認め合い、それぞれの強みを活かせる関係を築きましょう。</p>
                    <p>価値観の違いがある時は、まず相手の立場に立って考えてみましょう。</p>
                    <p>感謝の気持ちを日頃から言葉や行動で伝え合いましょう。</p>
                </div>
            </div>
        `;
        
        return html;
    },

    // レア度をフォーマット
    formatRarity(type1, type2) {
        const rarity = parseFloat(statistics.calculateRarity(type1, type2));
        
        // レアリティランクを決定
        let rank, rankName, rankColor, rankEmoji;
        if (rarity >= 10) {
            rank = 'common';
            rankName = 'コモン';
            rankColor = '#666666';
            rankEmoji = '⭐';
        } else if (rarity >= 5) {
            rank = 'uncommon';
            rankName = 'アンコモン';
            rankColor = '#4CAF50';
            rankEmoji = '⭐⭐';
        } else if (rarity >= 1) {
            rank = 'rare';
            rankName = 'レア';
            rankColor = '#2196F3';
            rankEmoji = '⭐⭐⭐';
        } else if (rarity >= 0.5) {
            rank = 'epic';
            rankName = 'エピック';
            rankColor = '#9C27B0';
            rankEmoji = '⭐⭐⭐⭐';
        } else {
            rank = 'legendary';
            rankName = 'レジェンダリー';
            rankColor = '#FF9800';
            rankEmoji = '⭐⭐⭐⭐⭐';
        }
        
        // 人数換算
        const per10000 = Math.round(10000 * (rarity / 100));
        const japanPopulation = Math.round(126000000 * (rarity / 100) / 2); // ペア数なので2で割る
        
        // ストーリー文章
        let story;
        if (rarity < 0.5) {
            story = `もしも1日1人と出会うなら、この相性の人と出会うまで約${Math.round(100/rarity/365)}年。まさに運命の出会いです！`;
        } else if (rarity < 1) {
            story = `学校全体を探しても、この組み合わせは1組いるかいないか。特別な縁を大切に！`;
        } else if (rarity < 5) {
            story = `街で偶然出会う確率は低いけれど、見つけたら離さないで！`;
        } else {
            story = `比較的出会いやすい組み合わせ。だからこそ、お互いを大切にする努力が重要です。`;
        }
        
        // プログレスバーの作成
        const progressWidth = Math.min(rarity * 2, 100); // 最大50%でスケール
        
        return `
            <div class="rarity-content">
                <div class="rarity-rank" style="color: ${rankColor}">
                    <span class="rank-emoji">${rankEmoji}</span>
                    <span class="rank-name">${rankName}級</span>
                </div>
                
                <div class="rarity-percentage">
                    <span class="percentage-number" data-value="${rarity}">${rarity}%</span>
                </div>
                
                <div class="rarity-stats">
                    <div class="stat-item">
                        <span class="stat-icon">👥</span>
                        <span class="stat-text">10,000人中<strong>${per10000}人</strong></span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">🗾</span>
                        <span class="stat-text">日本全国で約<strong>${japanPopulation.toLocaleString()}組</strong></span>
                    </div>
                </div>
                
                <div class="rarity-story">
                    <p>${story}</p>
                </div>
                
                <div class="rarity-comparison">
                    <p class="comparison-title">他の組み合わせと比較</p>
                    <div class="comparison-chart">
                        <div class="comparison-item">
                            <span>最も多い組み合わせ (ISFJ×ESFJ)</span>
                            <div class="comparison-bar">
                                <div class="comparison-fill" style="width: 100%"></div>
                                <span class="comparison-value">13.8%</span>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <span>平均的な組み合わせ</span>
                            <div class="comparison-bar">
                                <div class="comparison-fill" style="width: 45%"></div>
                                <span class="comparison-value">6.25%</span>
                            </div>
                        </div>
                        <div class="comparison-item current">
                            <span>あなたたち (${type1}×${type2})</span>
                            <div class="comparison-bar">
                                <div class="comparison-fill" style="width: ${Math.min(rarity * 7.2, 100)}%; background: ${rankColor}"></div>
                                <span class="comparison-value">${rarity}%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },

    // 擬人化データをフォーマット
    formatCharacterization(type1, type2) {
        const key = `${type1}-${type2}`;
        const characterization = characterizationData[key];
        
        if (!characterization) {
            return ''; // 擬人化データがない場合は何も表示しない
        }
        
        const type1Data = mbtiTypes[type1];
        const type2Data = mbtiTypes[type2];
        
        return `
            <div class="detail-section characterization-section">
                <h3>🎭 キャラクター設定</h3>
                <div class="characterization-content">
                    <div class="character-types">
                        <p>${type1Data.emoji} ${type1} ${type1Data.name} × ${type2Data.emoji} ${type2} ${type2Data.name}</p>
                    </div>
                    <div class="character-description">
                        <p>${characterization}</p>
                    </div>
                </div>
            </div>
        `;
    }
};

// エラーハンドリング
const errorHandler = {
    // エラーメッセージの表示
    showError(message, duration = 3000) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        errorDiv.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ff4444;
            color: white;
            padding: 15px 25px;
            border-radius: var(--radius-small);
            box-shadow: var(--shadow);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        `;
        
        document.body.appendChild(errorDiv);
        
        setTimeout(() => {
            errorDiv.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => errorDiv.remove(), 300);
        }, duration);
    }
};

// CSS追加（フェードアウトアニメーション）
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
`;
document.head.appendChild(style);